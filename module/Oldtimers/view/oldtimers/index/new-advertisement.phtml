<div class="row">
	<nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <a href="/" id="newAdvertisement" class="btn btn-operational navbar-btn pull-right"><?php echo $this->translate('List other cars') ?></a>
<!--             <a class="navbar-brand navbar-btn" href="/"><img src="/img/logo.png" alt="vozila.me"/></a> -->
            <h4><?php echo $this->translate('Advertisement form') ?></h4>
          </div>
        </div><!--/.container-fluid -->
      </nav>
</div>
<div class="row">
    <div id="advertisementBlock" class="col-lg-12">
        <form id="advertisementForm" action="/new" method="post" role="form" class="form" enctype="multipart/form-data">
            <div class="row">
        	    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group"><h3 class="text-center"><?php echo $this->translate('Let\'s describe your car') ?></h3></div>
            </div>
            <div class="row">
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <select id="make" name="make" class="form-control" data-error="Please select car maker" required>
                        <option value="" selected disabled><?php echo $this->translate('Who produced it?') ?></option>
                        <?php foreach ($make as $maker): ?>
                            <option value="<?php echo $maker['make']; ?>"><?php echo $maker['make']; ?></option>
                        <?php endforeach;?>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <select id="model" name="model" class="form-control" data-error="Please select model" required>
                        <option value="" selected disabled><?php echo $this->translate('Which model you have?') ?></option>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <input type="text" name="modification" class="form-control" placeholder="<?php echo $this->translate('Any specific modification (GTI, Sport, etc.)?') ?>"/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <input type="number" name="year" id="year" class="form-control" data-minlength="4" placeholder="<?php echo $this->translate('Year of production') ?>" data-error="<?php echo $this->translate('Please add car manufacture year') ?>" required/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <select id="transmission" name="transmission" class="form-control" data-error="<?php echo $this->translate('Please select transmission type') ?>" required>
                        <option value=""><?php echo $this->translate('How you switching gears?') ?></option>
                        <option value="manual"><?php echo $this->translate('Manual') ?></option>
                        <option value="automatic"><?php echo $this->translate('Automatic') ?></option>
                        <option value="tiptronik"><?php echo $this->translate('Tiptronic') ?></option>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <select id="fuelType" name="fuelType" class="form-control" data-error="<?php echo $this->translate('Please select fuel type') ?>" required>
                        <option value=""><?php echo $this->translate('Which fuel it works on?') ?></option>
                        <option value="diesel"><?php echo $this->translate('Disel') ?></option>
                        <option value="petrol"><?php echo $this->translate('Petrol') ?></option>
                        <option value="gas"><?php echo $this->translate('Gas') ?></option>
                        <option value="petrolAndGas"><?php echo $this->translate('Petrol + Gas') ?></option>
                        <option value="hybrid"><?php echo $this->translate('Hybrid') ?></option>
                        <option value="electric"><?php echo $this->translate('Electric') ?></option>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>
<!--             <div class="form-group"> -->
<!--                 <label for="engineType">Motor:</label> -->
<!--                 <input type="text" name="engineType" class="form-control"/> -->
<!--             </div> -->
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <input type="text" name="engineCapacity" class="form-control" data-minlength="3" placeholder="<?php echo $this->translate('Engine capacity') ?> (cm3)" data-error="<?php echo $this->translate('Please add engine capacity in cm3') ?>" required/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <input type="text" name="enginePower" class="form-control" placeholder="<?php echo $this->translate('Engine power') ?> (kW)"/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <input type="text" name="mileage" class="form-control" placeholder="<?php echo $this->translate('Mileage') ?> (km)" data-error="<?php echo $this->translate('Please add mileage') ?>" required/>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group"><h3 class="text-center"><?php echo $this->translate('Share more details, please') ?></h3></div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-12 form-group">
                    <ul id="features-list" class="list-group text-center">
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="climatisation" name="features[climatisation]"/><?php echo $this->translate('Climatisation') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="airConditioning" name="features[airConditioning]"><?php echo $this->translate('Air conditioning') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="powerAssistedSteering" name="features[powerAssistedSteering]"><?php echo $this->translate('Power Assisted Steering') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="audio" name="features[audio]"><?php echo $this->translate('Audio system') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="towHook" name="features[towHook]"><?php echo $this->translate('Tow hook') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="electricWindows" name="features[electricWindows]"><?php echo $this->translate('Electric Windows') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="electricHeatedSeats" name="features[electricHeatedSeats]"><?php echo $this->translate('Electric Heated Seats') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="centralLocking" name="features[centralLocking]"><?php echo $this->translate('Central Locking') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="parkingSensors" name="features[parkingSensors]"><?php echo $this->translate('Parking Sensors') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="fogLamp" name="features[fogLamp]"><?php echo $this->translate('Fog Lamp') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="remoteLock" name="features[remoteLock]"><?php echo $this->translate('Remote Lock') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="immobilizer" name="features[immobilizer]"><?php echo $this->translate('Immobilizer') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="navigationSystem" name="features[navigationSystem]"><?php echo $this->translate('Navigation System') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="cruiseControl" name="features[cruiseControl]"><?php echo $this->translate('Cruise Control') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="panoramicRoof" name="features[panoramicRoof]"><?php echo $this->translate('Panoramic Roof') ?></label></li>
                        <li class="list-group-item"><label class="checkbox"><input type="checkbox" value="xenonHeadlights" name="features[xenonHeadlights]"><?php echo $this->translate('Xenon Headlights') ?></label></li>
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                    <label for="description" class="control-label"><?php echo $this->translate('What you have to tell about this car?') ?></label>
                    <textarea name="description" class="form-control"></textarea>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group"><h3 class="text-center"><?php echo $this->translate('How to contact you?') ?></h3></div>
            </div>
            <div class="row">
                <div class=" col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <input type="text" name="owner[phoneNumber]" class="form-control" placeholder="<?php echo $this->translate('Your phone number') ?>" data-error="<?php echo $this->translate('Please, add telephone number') ?>" required/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <select id="city" name="owner[city]" class="form-control" data-error="<?php echo $this->translate('Please choose a city where car located') ?>" required>
                        <option value=""><?php echo $this->translate('Where is the car?') ?></option>
                        <?php foreach($cities as $city): ?>
                            <option value="<?= $city['name']?>"><?= $city['name']?></option>
                        <?php endforeach; ?>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>

                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                    <div class="input-group">
                        <span class="input-group-addon">€</span>
                        <input type="text" name="price" id="price" class="form-control" placeholder="<?php echo $this->translate('How much?') ?>" data-error="<?php echo $this->translate('Please choose some price') ?>" required/>
                    </div>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 form-group">
                    <div class="input-group">
                        <span class="input-group-addon">@</span>
                        <input type="email" name="owner[email]" class="form-control" placeholder="<?php echo $this->translate('Email address') ?>" data-error="<?php echo $this->translate('Email address is invalid') ?>" />
                    </div>
                    <span class="help-inline">we will send you links to control your advertisement</span>
                    <div class="help-block with-errors">we will send you links to control your advertisement</div>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                    <div class="table table-striped files" id="previews">
                        <div id="template" class="file-row col-lg-4 col-md-4 col-sm-6 col-xs-12">
                            <!-- This is used as the file preview template -->
                            <div>
                                <span class="preview"><img data-dz-thumbnail /><div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                        <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress></div>
                                </div></span>
                            </div>
                            <div>
    <!-- 							<p class="size" data-dz-size></p> -->
                            </div>
                            <div class="fileInfo">
                                <div class="name word-break" data-dz-name></div>
                                <div class="pull-right">
                                    <button data-dz-remove class="btn btn-operational delete">
                                        <i class="glyphicon glyphicon-trash"></i>
                                        <span>Delete</span>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <strong class="error text-danger" data-dz-errormessage></strong>
                            </div>
                        </div>
                    </div>

                    <div id="actions" class="row">
                      <div class="col-lg-12">
                        <!-- The fileinput-button span is used to style the file input field as button -->
                        <span class="btn btn-lg btn-operational fileinput-button btn-block center-block">
                            <i class="glyphicon glyphicon-plus"></i>
                            <span>Add nice photos of your car</span>
                        </span>
                      </div>

                      <div class="col-lg-12">
                        <!-- The global file processing state -->
                        <span class="fileupload-process">
                          <div id="total-progress" class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="display: none;">
                                <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress></div>
                          </div>
                        </span>
                      </div>

                    </div>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                    <button type="submit" id="post" class="btn btn-operational btn-block center-block"><?php echo $this->translate('Submit Advertisement') ?></button>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <input type="hidden" id="carDirectory" name="carDirectory" value=""/>
            <div id="filesInputsContainer"></div>
        </form>
    </div>
</div>

<script>
var carDirectory = '<?= $carDirectory ?>';

$(document).ready(function(){
    $('#carDirectory').val(carDirectory);
    
    // Get the template HTML and remove it from the doument
    var previewNode = document.querySelector("#template");
    previewNode.id = "";
    var previewTemplate = previewNode.parentNode.innerHTML;
    previewNode.parentNode.removeChild(previewNode);

    var myDropzone = new Dropzone(document.body, { // Make the whole body a dropzone
      url: "/index/saveFile", // Set the url
      params: { 
          carDirectory : $('#carDirectory').val()
          },
      maxFilesize: '2000',
      maxFiles: 15,
      thumbnailWidth: 350,
      thumbnailHeight: 220,
      parallelUploads: 15,
      previewTemplate: previewTemplate,
      acceptedFiles: 'image/jpeg, image/png, image/gif',
      autoQueue: true, // Make sure the files aren't queued until manually added
      previewsContainer: "#previews", // Define the container to display the previews
      clickable: ".fileinput-button", // Define the element that should be used as click trigger to select files.
      success: function(file, response){
          if(response){
          	console.log(response);
          	if(response.fileId && response.carDirectory) {
	            $('#carDirectory').val(response.carDirectory);
	            $('#filesInputsContainer').append($('<input>').attr('type', 'hidden').attr('name', 'photos[]').attr('value', response.fileId));
            }else{
	            $('body.dz-error-message').text(response);
            }
          }
      }
    });

    myDropzone.on("addedfile", function(file) {
      $('#post').attr('disabled', true);
      // Hookup the start button
      //file.previewElement.querySelector(".start").onclick = function() { myDropzone.enqueueFile(file); };
    });

    // Update the total progress bar
    myDropzone.on("totaluploadprogress", function(progress) {
    	document.querySelector("#total-progress .progress-bar").style.width = progress + "%";
    });

    myDropzone.on("sending", function(file) {
      // Show the total progress bar when upload starts
      document.querySelector("#total-progress").style.display = "block";
      // And disable the start button
      //file.previewElement.querySelector(".start").setAttribute("disabled", "disabled");
    });

    // Hide the total progress bar when nothing's uploading anymore
    myDropzone.on("queuecomplete", function(progress) {
        $('#post').attr('disabled', false);
    	document.querySelector("#total-progress").style.display = "none";
    });

    // Setup the buttons for all transfers
    // The "add files" button doesn't need to be setup because the config
    // `clickable` has already been specified.
//     document.querySelector("#actions .start").onclick = function() {
//       myDropzone.enqueueFiles(myDropzone.getFilesWithStatus(Dropzone.ADDED));
//     };
//     document.querySelector("#actions .cancel").onclick = function() {
//       myDropzone.removeAllFiles(true);
//     };
    
	$('#make').change(function(){
		$.ajax({
		  url: "index/getModelByMakeIdJson",
		  data: {'make' : $(this).val()}
		}).done(function(responce) {
			if(responce.success){
				var model = $("#model").empty();
				$.each(responce.models, function() {
					model.append($("<option />").val(this.model).text(this.model));
				});
			}
		});
	});

	$('#advertisementForm').find('button[type=submit]').on('click', function(e) {
        if ($('#advertisementForm').validator('validate').has('.has-error').length) {
        } else {
            $('#advertisementForm').submit();
        }
        return false;
    });

	$('#features-list').on('change', 'input', function(e){
		if($(this).is(':checked')){
			$(this).parent().parent().addClass('aliceblue');
			$(this).parent().parent().removeClass('white');
        }else{
			$(this).parent().parent().addClass('white');
			$(this).parent().parent().removeClass('aliceblue');
        }
    });
	
});
</script>

<?php 
	$this->headScript()->prependFile($this->basePath('js/validator.js'));
?>
